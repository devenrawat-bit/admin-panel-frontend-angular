<div class="users-page">

  <!-- Page Header -->
  <div class="users-header">
    <h2>Users</h2>
    <button class="btn-add" [routerLink]="['/users/add']">+ Add User</button>
  </div>

  <!-- Filters Row -->
  <div class="filters-row">

    <input
      type="text"
      placeholder="Search by name..."
      [(ngModel)]="filters.name"
      (ngModelChange)="onFilterChange()"
    />

    <input
      type="text"
      placeholder="Search by email..."
      [(ngModel)]="filters.email"
      (ngModelChange)="onFilterChange()"
    />

    <input
      type="text"
      placeholder="Search by phone..."
      [(ngModel)]="filters.phoneNumber"
      (ngModelChange)="onFilterChange()"
    />

    <input
      type="text"
      placeholder="Search by role..."
      [(ngModel)]="filters.role"
      (ngModelChange)="onFilterChange()"
    />

    <select [(ngModel)]="filters.isActive" (ngModelChange)="onFilterChange()">
      <option value="">All</option>
      <option value="true">Active</option>
      <option value="false">Inactive</option>
    </select>

    <button class="btn-clear" (click)="clearFilters()">Clear</button>
    
    <div class="search-loader" *ngIf="searching">
      <div class="spinner-small"></div>
    </div>
    
  </div>

  <!-- Users Table -->
  <table class="users-table">
    <thead>
      <tr>
        <th>Image</th>
        <th (click)="sortBy('FullName')">
          Name
          <span class="sort-icon">{{ getSortIcon('FullName') }}</span>
        </th>
        <th (click)="sortBy('Email')">
          Email
          <span class="sort-icon">{{ getSortIcon('Email') }}</span>
        </th>
        <th (click)="sortBy('PhoneNumber')">
          Phone Number
          <span class="sort-icon">{{ getSortIcon('PhoneNumber') }}</span>
        </th>
        <th (click)="sortBy('Roles')">
          Role
          <span class="sort-icon">{{ getSortIcon('Roles') }}</span>
        </th>
        <th (click)="sortBy('IsActive')">
          Is Active?
          <span class="sort-icon">{{ getSortIcon('IsActive') }}</span>
        </th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let user of users">
        <td>
          <ng-container *ngIf="user.profileUrl || user.profileImage || user.ProfileUrl || user.profileImageUrl; else noImage">
            <img [src]="getImageUrl(user.profileUrl || user.profileImage || user.ProfileUrl || user.profileImageUrl)" class="user-avatar" alt="Profile" />
          </ng-container>
          <ng-template #noImage>
            <div class="user-avatar-placeholder">
              <i class="fa-solid fa-user"></i>
            </div>
          </ng-template>
        </td>
        <td>{{ user.fullName }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.phoneNumber || '-' }}</td>
        <td>{{ getRoleDisplay(user) }}</td>

        <td>
          <label class="switch">
            <input
              type="checkbox"
              [checked]="user.isActive"
              (change)="toggleActive(user)"
            />
            <span class="slider"></span>
          </label>
        </td>

        <td class="actions">
          <button class="edit-btn" (click)="editUser(user)" title="Edit">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>
          <button class="delete-btn" (click)="deleteUser(user)" title="Delete">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>
      </tr>

      <tr *ngIf="!loading && users.length === 0">
        <td colspan="7" class="no-data">No users found</td>
      </tr>
      
      <tr *ngIf="loading">
        <td colspan="7" class="loading-cell">
          <div class="spinner"></div>
          <span>Loading users...</span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="pagination">

    <div class="page-info">
      {{ startIndex }} – {{ endIndex }} of {{ totalItems }}
    </div>

    <div class="page-controls">
      <button (click)="prevPage()" [disabled]="page === 1">‹</button>

      <button (click)="nextPage()" [disabled]="page * pageSize >= totalItems">›</button>

     <select [(ngModel)]="pageSize" (change)="changePageSize(+pageSize)">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="50">50</option>
      </select>
    </div>

  </div>

</div>
